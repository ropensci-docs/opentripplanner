<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="opentripplanner">
<title>opentripplanner: getting started • opentripplanner</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="opentripplanner: getting started">
<meta property="og:description" content="opentripplanner">
<meta property="og:image" content="https://docs.ropensci.org/opentripplanner/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">opentripplanner</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item">
  <a class="nav-link" href="../articles/opentripplanner.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Analyst.html">Analyst</a>
    <a class="dropdown-item" href="../articles/OTPv2.html">OpenTripPlanner Version 2</a>
    <a class="dropdown-item" href="../articles/advanced_features.html">Advanced Features</a>
    <a class="dropdown-item" href="../articles/known_issues.html">Known Issues</a>
    <a class="dropdown-item" href="../articles/prerequisites.html">Prerequisites</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/opentripplanner/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>opentripplanner: getting started</h1>
                        <h4 data-toc-skip class="author">Marcus Young, modified by Malcolm Morgan and Robin Lovelace</h4>
            
            <h4 data-toc-skip class="date">2024-03-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/opentripplanner/blob/HEAD/vignettes/opentripplanner.Rmd" class="external-link"><code>vignettes/opentripplanner.Rmd</code></a></small>
      <div class="d-none name"><code>opentripplanner.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette is an introduction to OpenTripPlanner (OTP) - an open-source and cross-platform multi-modal route planner written in Java. It uses imported OpenStreetMap (OSM) data for routing on the street and path network and supports multi-agency public transport routing through imported <a href="https://developers.google.com/transit/gtfs/" class="external-link">General Transit Feed Specification</a> (GTFS) feeds. It can also apply a digital elevation model to the OSM street network, allowing, for example, cycle-friendly routes to be requested. OTP has a web front-end that can be used by end-users and a sophisticated routing API.</p>
<p>OTP works worldwide as long as there is OSM map coverage in the area. Support for transit timetables and elevation calculations are dependant on the available data. For more information on getting data see the <a href="https://docs.ropensci.org/opentripplanner/articles/opentripplanner.html#getting-data-for-otp">getting data for OTP</a> section.</p>
<p>A significant advantage of running your own multi-modal route planner is the ability to carry out analysis using amended transport data. Services such as Google Maps or TransportAPI are based on current public transport schedules and the existing road network. OTP enables you to modify transit schedules and/or make changes to the underlying street network. By editing a local copy of OSM, you can model the effects of opening new roads, closing roads or imposing other restrictions. You can also look back in time. For example, you might want to examine the effect of reductions in rural bus services on the accessibility of health facilities. To do this, you would need a network with bus schedules as they were in previous years.</p>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>You will need to have installed R, RStudio, and Java 8. For more details on the required software, see the <a href="https://docs.ropensci.org/opentripplanner/articles/prerequisites.html">prerequisites vignette</a> included with this package.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the stable version of the package from CRAN as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"opentripplanner"</span><span class="op">)</span> <span class="co"># Install Package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/opentripplanner">opentripplanner</a></span><span class="op">)</span>            <span class="co"># Load Package</span></span></code></pre></div>
<p>Or you can install the development version from GitHub using the <strong>remotes</strong> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/opentripplanner"</span><span class="op">)</span> <span class="co"># Install Package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/opentripplanner">opentripplanner</a></span><span class="op">)</span>                            <span class="co"># Load Package</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-otp-and-the-demonstration-data">Downloading OTP and the demonstration data<a class="anchor" aria-label="anchor" href="#downloading-otp-and-the-demonstration-data"></a>
</h2>
<p>We will build an example graph for the Isle of Wight using some example data provided for the package. A graph is what OTP uses to find routes, and must be built out of the raw data provided. Please note the demo data has been modified for teaching purposes and should not be used for analysis.</p>
<div class="section level3">
<h3 id="creating-a-folder-to-store-otp-and-its-data">Creating a folder to store OTP and its data<a class="anchor" aria-label="anchor" href="#creating-a-folder-to-store-otp-and-its-data"></a>
</h3>
<p>OTP expects its data to be stored in a specific structure, see <a href="https://docs.ropensci.org/opentripplanner/articles/opentripplanner.html#building-your-own-otp-graph">building your own otp graph</a> for more details. We will make a folder called OTP in the temporary directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"OTP"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">)</span> </span></code></pre></div>
<p><strong>You may wish to change this</strong> to keep your files after closing R. Otherwise you will need to download your files and build your graph every time. For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/Users/Public"</span>, <span class="st">"OTP"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downloading-otp">Downloading OTP<a class="anchor" aria-label="anchor" href="#downloading-otp"></a>
</h3>
<p>As of version 0.3 the <code>otp_dl_jar</code> function will download and cache the OTP jar file. So you can simply get the path to the OTP JAR file like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_otp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_dl_jar.html">otp_dl_jar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>otp_dl_jar</code> will first check its internal cache for the JAR file and only download it if it is unavailable.</p>
<p>If you wish to specify the location the JAR file is saved (as in version 0.2) use:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_otp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_dl_jar.html">otp_dl_jar</a></span><span class="op">(</span><span class="va">path_data</span>, cache <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downloading-example-data">Downloading Example Data<a class="anchor" aria-label="anchor" href="#downloading-example-data"></a>
</h3>
<p>The <code>otp_dl_demo</code> function downloads the demonstration data and puts it in the correct structure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/otp_dl_demo.html">otp_dl_demo</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-an-otp-graph">Building an OTP Graph<a class="anchor" aria-label="anchor" href="#building-an-otp-graph"></a>
</h2>
<p>Now we can build the graph. This code will create a new file <code>Graph.obj</code> that will be saved in the location defined by <code>path_data</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_build_graph.html">otp_build_graph</a></span><span class="op">(</span>otp <span class="op">=</span> <span class="va">path_otp</span>, dir <span class="op">=</span> <span class="va">path_data</span><span class="op">)</span> </span></code></pre></div>
<p>By default, R will assign OTP 2GB of memory to build the graph. For larger areas, you may need more memory. You can use the <code>memory</code> argument to set the memory allocation in MB. For example, to allocate 10GB, you would use:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_build_graph.html">otp_build_graph</a></span><span class="op">(</span>otp <span class="op">=</span> <span class="va">path_otp</span>, dir <span class="op">=</span> <span class="va">path_data</span>, memory <span class="op">=</span> <span class="fl">10240</span><span class="op">)</span> </span></code></pre></div>
<p>Note that you cannot allocate more memory than you have RAM, and if you use 32 Bit Java you cannot allocate more than 3GB. It is possible to run OTP in just 1GB of memory for very small areas (including the demo dataset).</p>
</div>
<div class="section level2">
<h2 id="launch-otp-and-load-the-graph">Launch OTP and load the graph<a class="anchor" aria-label="anchor" href="#launch-otp-and-load-the-graph"></a>
</h2>
<p>The next step is to start up your OTP server, running the router called ‘default’. OTP will load the graph you created into memory, and you will then be able to plan multi-modal routes using the web interface. Run the following command:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_setup.html">otp_setup</a></span><span class="op">(</span>otp <span class="op">=</span> <span class="va">path_otp</span>, dir <span class="op">=</span> <span class="va">path_data</span><span class="op">)</span></span></code></pre></div>
<p>OTP has a built-in web server called Grizzly which runs on port 8080 (http) and 8081 (https). If you have another application running on your computer that uses these ports then you will need to specify alternative ports using the <code>port</code> and <code>securePort</code> options, for example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_setup.html">otp_setup</a></span><span class="op">(</span>otp <span class="op">=</span> <span class="va">path_otp</span>, dir <span class="op">=</span> <span class="va">path_data</span>, port <span class="op">=</span> <span class="fl">8801</span>, securePort <span class="op">=</span> <span class="fl">8802</span><span class="op">)</span></span></code></pre></div>
<p>It should only take a minute or two for OTP to load the graph and start the Grizzly server. If it has worked, you should see the message: <code>OTP is ready to use</code>, and R will open your web browser at the OTP.</p>
<p>You can also access the web interface using the URL: <code>http://localhost:8080</code>. You can now zoom into the Isle of Wight area and request a route by setting an origin and a destination directly on the map (by right-clicking your mouse). You can specify travel dates, times and modes using the ‘Trip Options’ window (see Figure). You can change the background map from the layer stack icon at the top right.</p>
<div class="figure" style="text-align: center">
<img src="images/otpwebgui.jpg" alt="\label{fig:otpgui}OTP Web Interface"><p class="caption">
OTP Web Interface
</p>
</div>
<p><strong>Note:</strong> The web interface does not work correctly in Internet Explorer - use Firefox or Chrome.</p>
</div>
<div class="section level2">
<h2 id="connecting-to-the-otp-from-r">Connecting to the OTP from R<a class="anchor" aria-label="anchor" href="#connecting-to-the-otp-from-r"></a>
</h2>
<p>Now you have the OTP running on your computer you can let R connect to the OTP. <code><a href="../reference/otp_connect.html">otp_connect()</a></code> creates an OTP connection object which will allow R to connect to the OTP. By default, your local timezone is used, but if you are not in the UK, you need to specify the UK timezone to get the correct results with the demo data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">otpcon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_connect.html">otp_connect</a></span><span class="op">(</span>timezone <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span></code></pre></div>
<p>The connection is created and tested, and a message will be returned, saying if the connection exists or not. If you have not used the default settings, such as a different <code>port</code> you can specify those settings in <code><a href="../reference/otp_connect.html">otp_connect()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">otpcon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_connect.html">otp_connect</a></span><span class="op">(</span>hostname <span class="op">=</span>  <span class="st">"localhost"</span>,</span>
<span>                      router <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>                      port <span class="op">=</span> <span class="fl">8801</span><span class="op">)</span></span></code></pre></div>
<p>You can also use the <code><a href="../reference/otp_connect.html">otp_connect()</a></code> function to make a connection to OTP on a remote server. If the server uses a non-standard structure for the API, you can provide the full URL directly to <code><a href="../reference/otp_connect.html">otp_connect()</a></code>. See the <code><a href="../reference/otp_connect.html">otp_connect()</a></code> help for more details.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">otpcon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_connect.html">otp_connect</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://api.digitransit.fi/routing/v1/routers/hsl"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-a-route-from-the-otp">Getting a route from the OTP<a class="anchor" aria-label="anchor" href="#getting-a-route-from-the-otp"></a>
</h2>
<p>Now we can use R to get a route from the OTP. OTP accepts pairs of longitude/latitude coordinates for a <code>fromPlace</code> (start of the journey) and <code>toPlace</code> (end of the journey).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/otp_plan.html">otp_plan</a></span><span class="op">(</span><span class="va">otpcon</span>, </span>
<span>                  fromPlace <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.17502</span>, <span class="fl">50.64590</span><span class="op">)</span>, </span>
<span>                  toPlace <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.15339</span>, <span class="fl">50.72266</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you have the <code>tmap</code> package installed, you can view the route using.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("tmap") # Only needed if you don't have tmap</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span>              <span class="co"># Load the tmap package</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span>          <span class="co"># Set tmap to interactive viewing</span></span>
<span><span class="fu">qtm</span><span class="op">(</span><span class="va">route</span><span class="op">)</span>                 <span class="co"># Plot the route on a map</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="stopping-the-otp">Stopping the OTP<a class="anchor" aria-label="anchor" href="#stopping-the-otp"></a>
</h2>
<p>As the OTP is running in Java, it will continue to run after you close R.</p>
<p>You can stop the OTP running using the command. <strong>NOTE: This will stop all running JAVA applications!</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/otp_stop.html">otp_stop</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Congratulations, you now have your own multi-modal router planner!</p>
</div>
<div class="section level2">
<h2 id="building-your-own-otp-graph">Building your own OTP Graph<a class="anchor" aria-label="anchor" href="#building-your-own-otp-graph"></a>
</h2>
<p>If you want to build your own graph for a different location, follow these steps, and change your <code>path_data</code> variable to the folder with your data.</p>
<p>An OTP graph specifies every location in the region covered and how to travel between them, and is compiled by OTP using OSM data for the street and path network (used for walking, bicycle, and drive modes) and GTFS data for transit scheduling.</p>
<p>Our first task is to create the folder and file structure expected by OTP. This is a base directory called <code>otp</code> which contains a sub-directory called <code>graphs</code>. Directories created under <code>graphs</code> are known as OTP routers and contain all the files required to build a graph. A single OTP instance can host several routers, for example, covering different regions.</p>
<p>The basic file structure is shown below.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/</span> otp                         <span class="co"># Your top folder for storing all OTP data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/graphs</span>                     </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="ex">/default</span>                 <span class="co"># Subfolder with the name of the router</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="ex">osm.pbf</span>              <span class="co"># Required OSM road map</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="ex">router-config.json</span>   <span class="co"># Optional config file</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="ex">build-config.json</span>    <span class="co"># Optional config file</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         <span class="ex">gtfs.zip</span>             <span class="co"># Optional GTFS data</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>         <span class="ex">dem.tif</span>              <span class="co"># Optional Elevation data</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         </span></code></pre></div>
<p><code>router-config.json</code> is read when the OTP server is started, while <code>build-config.json</code> is read during the graph building stage. For more information on the config files, see the <a href="https://docs.ropensci.org/opentripplanner/articles/advanced_features.html">advanced features vignette</a>.</p>
<div class="section level3">
<h3 id="multiple-routers">Multiple Routers<a class="anchor" aria-label="anchor" href="#multiple-routers"></a>
</h3>
<p>OTP supports multiple routes by having them in separate folders. For example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/</span> otp                        <span class="co"># Your top folder for storing all OTP data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/graphs</span>                     </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="ex">/london</span>                 <span class="co"># router called london</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="ex">osm.pbf</span>             <span class="co"># map of London</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>     <span class="ex">/manchester</span>             <span class="co"># router called manchester</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="ex">osm.pbf</span>             <span class="co"># map of Manchester</span></span></code></pre></div>
<p>Having multiple routers may be useful to support different regions, or different scenarios, e.g. past, present, future.</p>
<p>Each router requires its own graph via <code><a href="../reference/otp_build_graph.html">otp_build_graph()</a></code> but only one version of the OTP jar files is needed (i.e. <code><a href="../reference/otp_dl_jar.html">otp_dl_jar()</a></code>) Each route must be started via <code><a href="../reference/otp_setup.html">otp_setup()</a></code> before use. While it is technically possible to run multiple routers simultaneously, it is not recommended for performance reasons.</p>
</div>
<div class="section level3">
<h3 id="getting-data-for-otp">Getting Data for OTP<a class="anchor" aria-label="anchor" href="#getting-data-for-otp"></a>
</h3>
<p>To use OTP on your local computer, you will need data about your location of interest, such as where the roads are, what is the public transport timetable etc.</p>
<div class="section level4">
<h4 id="road-map-data">Road Map Data<a class="anchor" aria-label="anchor" href="#road-map-data"></a>
</h4>
<p>OTP uses road maps from the <a href="https://www.openstreetmap.org" class="external-link">Open Street Map (OSM)</a> in the <a href="https://wiki.openstreetmap.org/wiki/OSM_file_formats" class="external-link">.osm or .pbf format</a>. OSM is a free map that anybody can edit. You can download all or part of the OSM from <a href="https://download.geofabrik.de/" class="external-link">Geofabrik</a>.</p>
<p>Note that OTP only really needs the road network from the OSM, but the Geofabrik downloads include non-road data such as buildings, parks, water etc. So for large areas, you may wish to remove unneeded data from the file before building the graph. You can do this using <a href="https://wiki.openstreetmap.org/wiki/Osmconvert" class="external-link">osmconvert</a> and <a href="https://wiki.openstreetmap.org/wiki/Osmfilter" class="external-link">osmfilter</a>. These are command-line utilities for editing large OSM files and are documented on the OSM Wiki. For small areas (e.g. city scale) this is not necessary.</p>
</div>
<div class="section level4">
<h4 id="public-transport-timetables">Public Transport Timetables<a class="anchor" aria-label="anchor" href="#public-transport-timetables"></a>
</h4>
<p>OTP can use public transport timetable data in the <a href="https://developers.google.com/transit/gtfs/" class="external-link">GTFS format</a>. You can find GTFS data for many regions at <a href="https://www.transit.land/" class="external-link">transitland</a>. For users in the UK see <a href="https://itsleeds.github.io/UK2GTFS/" class="external-link">UK2GTFS</a></p>
</div>
<div class="section level4">
<h4 id="elevation-data">Elevation Data<a class="anchor" aria-label="anchor" href="#elevation-data"></a>
</h4>
<p>You can add terrain information to your routes, especially useful for walking and cycling, using <a href="https://trac.osgeo.org/geotiff" class="external-link">GeoTIFF images</a>. You can find worldwide elevation data from <a href="https://www2.jpl.nasa.gov/srtm/" class="external-link">NASA</a>.</p>
<p><strong>Warning</strong> It is common for GeoTIFF to have a no data value often the maximum possible value. OTP can misinterpret this as an elevation value. So set your no data values in your elevation data to something more plausible like 0.</p>
<p><strong>Note</strong> that OTP does not support all types of GeoTIFF compression so you may have to change the compression type of the image if you are experiencing problems.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
